!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@angular/core")):"function"==typeof define&&define.amd?define("ng-lazyload-image",["exports","rxjs","rxjs/operators","@angular/common","@angular/core"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["ng-lazyload-image"]={},t.rxjs,t.rxjs.operators,t.ng.common,t.ng.core)}(this,(function(t,e,n,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}Object.create;function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function u(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}Object.create;function c(t){return Boolean(t.parentElement&&"picture"===t.parentElement.nodeName.toLowerCase())}function l(t){return"img"===t.nodeName.toLowerCase()}function p(t,e,n){return l(t)?n&&"srcset"in t?t.srcset=e:t.src=e:t.style.backgroundImage="url('"+e+"')",t}function f(t){return function(e){for(var n=e.parentElement.getElementsByTagName("source"),r=0;r<n.length;r++){var o=n[r].getAttribute(t);o&&("srcset"in n[r]?n[r].srcset=o:n[r].src=o)}}}var h=f("defaultImage"),g=f("lazyLoad"),d=f("errorImage");function m(t){return function(e,n,r){l(e)&&c(e)&&t(e),n&&p(e,n,r)}}var b=m(h),y=m(g),v=m(d),I=function(){function t(){this.navigator="undefined"!=typeof window?window.navigator:void 0}return t.prototype.setPlatformId=function(t){this.platformId=t},t.prototype.onDestroy=function(t){},t.prototype.onAttributeChange=function(t){},t}(),S="ng-lazyloaded",w="ng-lazyloading",C="ng-failed-lazyloaded";function L(t,e){t.className=t.className.replace(e,"")}function k(t,e){t.className.includes(e)||(t.className+=" "+e)}var O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.setup=function(t){var e,n;b(t.element,t.defaultImagePath,t.useSrcset),k(t.element,w),e=t.element,n=S,e.className&&e.className.includes(n)&&L(t.element,S)},e.prototype.finally=function(t){k(t.element,S),L(t.element,w)},e.prototype.loadImage=function(t){if(this.skipLazyLoading(t))return[t.imagePath];var e,n=t.element,r=t.useSrcset,o=t.imagePath,i=t.decode;if(l(n)&&c(n)){var s=n.parentNode.cloneNode(!0);e=s.getElementsByTagName("img")[0],g(e),p(e,o,r)}else e=new Image,l(n)&&n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy),l(n)&&n.sizes&&(e.sizes=n.sizes),r&&"srcset"in e?e.srcset=o:e.src=o;return i&&e.decode?e.decode().then((function(){return o})):new Promise((function(t,n){e.onload=function(){return t(o)},e.onerror=function(){return n(null)}}))},e.prototype.setErrorImage=function(t,e){var n=e.element,r=e.useSrcset,o=e.errorImagePath;v(n,o,r),k(n,C)},e.prototype.setLoadedImage=function(t,e){var n=e.element,r=e.useSrcset;y(n,t,r)},e.prototype.isDisabled=function(){return r.isPlatformServer(this.platformId)&&!this.isBot()},e.prototype.skipLazyLoading=function(t){return this.isBot(t)},e.prototype.isBot=function(t){var e;return!!(null===(e=this.navigator)||void 0===e?void 0:e.userAgent)&&/googlebot|bingbot|yandex|baiduspider|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora\ link\ preview|showyoubot|outbrain|pinterest\/0\.|pinterestbot|slackbot|vkShare|W3C_Validator|whatsapp|duckduckbot/i.test(this.navigator.userAgent)},e}(I),j=function(t){function r(){var n=t.apply(this,u(arguments))||this;return n.observers=new WeakMap,n.intersectionSubject=new e.Subject,n.uniqKey={},n}return s(r,t),r.prototype.getObservable=function(t){var r=this;if(this.skipLazyLoading(t))return e.of({isIntersecting:!0});if(t.customObservable)return t.customObservable;var o=t.scrollContainer||this.uniqKey,i={root:t.scrollContainer||null};t.offset&&(i.rootMargin=t.offset+"px");var s=this.observers.get(o);return s||(s=new IntersectionObserver((function(t){return r.loadingCallback(t)}),i),this.observers.set(o,s)),s.observe(t.element),e.Observable.create((function(e){var o=r.intersectionSubject.pipe(n.filter((function(e){return e.target===t.element}))).subscribe(e);return function(){o.unsubscribe(),s.unobserve(t.element)}}))},r.prototype.isVisible=function(t){return t.isIntersecting},r.prototype.loadingCallback=function(t){var e=this;t.forEach((function(t){return e.intersectionSubject.next(t)}))},r}(O);var x=new o.InjectionToken("LazyLoadImageHooks"),E=function(){function t(t,n,r,i){this.onStateChange=new o.EventEmitter,this.elementRef=t,this.ngZone=n,this.propertyChanges$=new e.ReplaySubject,this.hooks=i,this.hooks.setPlatformId(r),this.uid=Math.random().toString(36).substr(2,9)}return t.prototype.ngOnChanges=function(){!0!==this.debug||this.debugSubscription||(this.debugSubscription=this.onStateChange.subscribe((function(t){return console.log(t)}))),this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,offset:this.offset?0|this.offset:0,scrollContainer:this.scrollTarget,customObservable:this.customObservable,decode:this.decode,onStateChange:this.onStateChange,id:this.uid})},t.prototype.ngAfterContentInit=function(){var t=this;if(this.hooks.isDisabled())return null;this.ngZone.runOutsideAngular((function(){t.loadSubscription=t.propertyChanges$.pipe(n.tap((function(e){return t.hooks.onAttributeChange(e)})),n.tap((function(t){return t.onStateChange.emit({reason:"setup"})})),n.tap((function(e){return t.hooks.setup(e)})),n.switchMap((function(r){return r.imagePath?t.hooks.getObservable(r).pipe(function(t,r){return function(o){return o.pipe(n.tap((function(t){return r.onStateChange.emit({reason:"observer-emit",data:t})})),n.filter((function(e){return t.isVisible(e,r)})),n.take(1),n.tap((function(){return r.onStateChange.emit({reason:"start-loading"})})),n.mergeMap((function(){return t.loadImage(r)})),n.tap((function(){return r.onStateChange.emit({reason:"mount-image"})})),n.tap((function(e){return t.setLoadedImage(e,r)})),n.tap((function(){return r.onStateChange.emit({reason:"loading-succeeded"})})),n.map((function(){return!0})),n.catchError((function(n){return r.onStateChange.emit({reason:"loading-failed",data:n}),t.setErrorImage(n,r),e.of(!1)})),n.tap((function(){r.onStateChange.emit({reason:"finally"}),t.finally(r)})))}}(t.hooks,r)):e.never()}))).subscribe({next:function(){return null}})}))},t.prototype.ngOnDestroy=function(){var t,e,r=this;this.propertyChanges$.pipe(n.take(1)).subscribe({next:function(t){return r.hooks.onDestroy(t)}}).unsubscribe(),null===(t=this.loadSubscription)||void 0===t||t.unsubscribe(),null===(e=this.debugSubscription)||void 0===e||e.unsubscribe()},t}();E.decorators=[{type:o.Directive,args:[{selector:"[lazyLoad]"}]}],E.ctorParameters=function(){return[{type:o.ElementRef},{type:o.NgZone},{type:Object,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]},{type:I,decorators:[{type:o.Inject,args:[x]}]}]},E.propDecorators={lazyImage:[{type:o.Input,args:["lazyLoad"]}],defaultImage:[{type:o.Input}],errorImage:[{type:o.Input}],scrollTarget:[{type:o.Input}],customObservable:[{type:o.Input}],offset:[{type:o.Input}],useSrcset:[{type:o.Input}],decode:[{type:o.Input}],debug:[{type:o.Input}],onStateChange:[{type:o.Output}]};var z=function(){};z.decorators=[{type:o.NgModule,args:[{declarations:[E],exports:[E],providers:[{provide:x,useClass:j}]}]}];var P=function(){function t(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r}return t.fromElement=function(e){var n=e.getBoundingClientRect(),r=n.left,o=n.top,i=n.right,s=n.bottom;return 0===r&&0===o&&0===i&&0===s?t.empty:new t(r,o,i,s)},t.fromWindow=function(e){return new t(0,0,e.innerWidth,e.innerHeight)},t.prototype.inflate=function(t){this.left-=t,this.top-=t,this.right+=t,this.bottom+=t},t.prototype.intersectsWith=function(t){return t.left<this.right&&this.left<t.right&&t.top<this.bottom&&this.top<t.bottom},t.prototype.getIntersectionWith=function(e){var n=Math.max(this.left,e.left),r=Math.max(this.top,e.top),o=Math.min(this.right,e.right),i=Math.min(this.bottom,e.bottom);return o>=n&&i>=r?new t(n,r,o,i):t.empty},t}();P.empty=new P(0,0,0,0);var W=function(t){function r(){var n=t.apply(this,u(arguments))||this;return n.getWindow=function(){return window},n.scrollListeners=new WeakMap,n.getScrollListener=function(t){if(!t||"function"!=typeof t.addEventListener)return console.warn("`addEventListener` on "+t+" (scrollTarget) is not a function. Skipping this target"),e.empty();var r=n.scrollListeners.get(t);if(r)return r;var o=e.Observable.create((function(e){var n="scroll",r=function(t){return e.next(t)},o={passive:!0,capture:!1};return t.addEventListener(n,r,o),function(){return t.removeEventListener(n,r,o)}})),i=n.sampleObservable(o);return n.scrollListeners.set(t,i),i},n}return s(r,t),r.prototype.getObservable=function(t){return this.skipLazyLoading(t)?e.of("load"):t.customObservable?t.customObservable.pipe(n.startWith("")):t.scrollContainer?this.getScrollListener(t.scrollContainer):this.getScrollListener(this.getWindow())},r.prototype.isVisible=function(t,e){var n=P.fromElement(e.element);if(n===P.empty)return!1;var r=P.fromWindow(this.getWindow());if(n.inflate(e.offset),e.scrollContainer){var o=P.fromElement(e.scrollContainer).getIntersectionWith(r);return n.intersectsWith(o)}return n.intersectsWith(r)},r.prototype.sampleObservable=function(t,e){return t.pipe(n.sampleTime(100,e),n.share(),n.startWith(""))},r}(O);t.Hooks=I,t.IntersectionObserverHooks=j,t.LAZYLOAD_IMAGE_HOOKS=x,t.LazyLoadImageDirective=E,t.LazyLoadImageModule=z,t.ScrollHooks=W,t.SharedHooks=O,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-lazyload-image.umd.min.js.map